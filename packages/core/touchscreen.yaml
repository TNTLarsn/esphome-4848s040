#-------------------------------------------
# Touchscreen gt911 i2c
#-------------------------------------------

i2c:
  - id: bus_a
    sda: GPIO19
    scl:
      number: GPIO45
      ignore_strapping_warning: true
    # Reduced from default (400kHz) to 100kHz to improve GT911 reliability on this PCB;
    # higher I2C speeds caused intermittent touch events / ghost touches, so we trade
    # a small reduction in maximum touch update rate for stable, accurate input.
    frequency: 100kHz
    
touchscreen:
  platform: gt911
  transform:
    mirror_x: false
    mirror_y: false
  id: my_touchscreen
  display: my_display

  on_touch:
    - logger.log:
          format: Touch at (%d, %d)
          args: [touch.x, touch.y]
    - lambda: |-
          ESP_LOGI("cal", "x=%d, y=%d, x_raw=%d, y_raw=%0d",
              touch.x,
              touch.y,
              touch.x_raw,
              touch.y_raw
              );
  on_release:
      - if:
          condition: lvgl.is_paused
          then:
            - logger.log: "LVGL resuming"
            - lvgl.resume:
            - lvgl.widget.redraw:
            - light.turn_on: display_backlight
    #- script.stop: screen_light
    #- script.execute: screen_light
    # TODO: Re-enable screen_light script calls when automatic backlight timeout / dimming is implemented.
    # - script.stop: screen_light
    # - script.execute: screen_light

lvgl:
  displays: my_display
  touchscreens: 
    - touchscreen_id: my_touchscreen
      long_press_time: 5000ms
      long_press_repeat_time: 400ms